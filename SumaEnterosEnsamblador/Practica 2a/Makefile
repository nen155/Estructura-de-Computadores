###############################################################################
# Makefile
###############################################################################

SHELL = /bin/bash # for ubuntu

###############################################################################

SRC = $(wildcard *.cc)
ASM = $(wildcard *.s)
OBJ = $(ASM:.s=.o)
EXE = $(basename $(OBJ) $(SRC)) p
ATT = $(EXE:=.att)

###############################################################################

ASFLAGS = --32 -g
LDFLAGS = -melf_i386
CFLAGS = -fno-omit-frame-pointer -g3 -m32 -O3 -Wall
CXXFLAGS = $(CFLAGS)

###############################################################################

all:	$(OBJ) $(EXE) $(ATT)

clean:
	$(RM) -rfv $(ATT) $(EXE) $(OBJ) core.* *.o *~

###############################################################################

p:	p1.c p2.c
	$(CC) $(CFLAGS) $^ -o $@

saludo: CFLAGS+=-nostartfiles

suma: CFLAGS+=-nostartfiles

%: %.s
	$(CC) $(CFLAGS) $< -o $@

%.o: %.s
	$(AS) $(ASFLAGS) $< -o $@

%: %.o
	$(LD) $(LDFLAGS) $< -o $@

%: %.c
	$(CC) $(CFLAGS) $< -o $@

%: %.cc
	$(CXX) $(CXXFLAGS) $< -o $@

%.att: %
	objdump -C -d $< > $@

###############################################################################
